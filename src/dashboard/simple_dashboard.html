<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Project Sentinel – CX Command Center</title>
    <style>
      :root {
        --bg: #f5f7fb;
        --surface: #ffffff;
        --surface-soft: #f8fafc;
        --surface-muted: #eef2ff;
        --text-primary: #0f172a;
        --text-muted: #64748b;
        --border: #e2e8f0;
        --accent: #2563eb;
        --accent-secondary: #4f46e5;
        --accent-soft: rgba(37, 99, 235, 0.12);
        --accent-gradient: radial-gradient(circle at 0% 0%, rgba(37, 99, 235, 0.18), rgba(79, 70, 229, 0.05) 45%, rgba(15, 23, 42, 0.02));
        --success: #16a34a;
        --warning: #f97316;
        --danger: #dc2626;
        --shadow: 0 22px 55px rgba(15, 23, 42, 0.08);
        --radius-lg: 22px;
        --radius-xl: 28px;
        font-family: "Inter", "Segoe UI", sans-serif;
      }

      * {
        box-sizing: border-box;
      }

      html {
        scroll-behavior: smooth;
      }

      body {
        margin: 0;
        background: var(--bg);
        color: var(--text-primary);
        min-height: 100vh;
        display: flex;
      }

      a {
        color: inherit;
        text-decoration: none;
      }

      .app-shell {
        display: flex;
        width: 100%;
        min-height: 100vh;
      }

      .sidebar {
        width: 264px;
        background: var(--surface);
        border-right: 1px solid var(--border);
        padding: 32px 28px;
        display: flex;
        flex-direction: column;
        gap: 28px;
        position: sticky;
        top: 0;
        height: 100vh;
      }

      .sidebar__brand {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .sidebar__title {
        font-size: 1.35rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .sidebar__logo {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 36px;
        height: 36px;
        border-radius: 12px;
        background: var(--accent-soft);
        color: var(--accent);
        font-size: 1.1rem;
      }

      .sidebar__subtitle {
        color: var(--text-muted);
        font-size: 0.85rem;
        margin: 0;
      }

      .sidebar__nav {
        display: grid;
        gap: 10px;
      }

      .sidebar__nav a {
        padding: 10px 14px;
        border-radius: 12px;
        color: var(--text-muted);
        font-size: 0.95rem;
        font-weight: 500;
        transition: background 0.18s ease, color 0.18s ease;
      }

      .sidebar__nav a:hover,
      .sidebar__nav a:focus {
        background: var(--accent-soft);
        color: var(--accent);
      }

      .sidebar__support {
        margin-top: auto;
        font-size: 0.82rem;
        color: var(--text-muted);
        border-top: 1px solid var(--border);
        padding-top: 18px;
      }

      .app-main {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      .top-bar {
        padding: 32px 40px 18px;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 32px;
      }

      .top-bar__titles {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .top-bar h1 {
        margin: 0;
        font-size: clamp(1.7rem, 2.6vw, 2.5rem);
        letter-spacing: -0.015em;
      }

      .top-bar p {
        margin: 0;
        color: var(--text-muted);
        font-size: 0.97rem;
        max-width: 580px;
      }

      .top-bar__meta {
        display: flex;
        align-items: center;
        gap: 18px;
      }

      .status-chip {
        display: inline-flex;
        align-items: center;
        gap: 0.6rem;
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 999px;
        padding: 0.5rem 1rem;
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--success);
        box-shadow: 0 6px 18px rgba(22, 163, 74, 0.12);
      }

      .status-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: var(--success);
        box-shadow: 0 0 0 4px rgba(22, 163, 74, 0.15);
      }

      .sync-indicator {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 0.55rem 1rem;
        display: grid;
        gap: 0.2rem;
        min-width: 150px;
      }

      .sync-indicator span {
        font-size: 0.72rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-muted);
      }

      .sync-indicator strong {
        font-size: 1.05rem;
        letter-spacing: -0.01em;
      }

      .content-grid {
        padding: 0 40px 44px;
        display: grid;
        gap: 32px;
      }

      section.panel {
        background: var(--surface);
        border: 1px solid rgba(15, 23, 42, 0.06);
        border-radius: var(--radius-lg);
        padding: 26px 28px;
        box-shadow: var(--shadow);
        display: flex;
        flex-direction: column;
        gap: 1.4rem;
        position: relative;
        overflow: hidden;
      }

      .panel--wide {
        grid-column: 1 / -1;
      }

      .panel--hero {
        padding: 32px 34px;
        border-radius: var(--radius-xl);
        background: var(--accent-gradient);
        box-shadow: 0 35px 60px rgba(37, 99, 235, 0.12);
      }

      .panel--hero::after {
        content: "";
        position: absolute;
        inset: 0;
        pointer-events: none;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.12), transparent 60%);
        opacity: 0.8;
      }

      .panel--hero * {
        position: relative;
        z-index: 1;
      }

      .panel__header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 18px;
      }

      .panel__title {
        margin: 0;
        font-size: 1.28rem;
        letter-spacing: -0.01em;
      }

      .panel__hint {
        margin: 4px 0 0;
        color: var(--text-muted);
        font-size: 0.86rem;
        max-width: 360px;
      }

      .panel__meta {
        display: flex;
        flex-wrap: wrap;
        gap: 0.35rem;
      }

      .chip {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        padding: 0.35rem 0.75rem;
        border-radius: 999px;
        background: var(--accent-soft);
        color: var(--accent);
        font-size: 0.78rem;
        font-weight: 600;
        letter-spacing: 0.06em;
        text-transform: uppercase;
        border: 1px solid rgba(37, 99, 235, 0.2);
      }

      .chip--outline {
        background: rgba(255, 255, 255, 0.25);
        color: var(--accent-secondary);
      }

      .chip--neutral {
        background: var(--surface-soft);
        border-color: rgba(148, 163, 184, 0.35);
        color: var(--text-muted);
      }

      .hero-grid {
        display: grid;
        gap: 20px;
        grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
      }

      .hero-card {
        background: rgba(255, 255, 255, 0.78);
        backdrop-filter: blur(6px);
        border-radius: 18px;
        border: 1px solid rgba(37, 99, 235, 0.18);
        padding: 18px 22px;
        display: grid;
        gap: 0.6rem;
      }

      .hero-card h3 {
        margin: 0;
        font-size: 0.95rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: rgba(14, 23, 42, 0.68);
      }

      .hero-card .metric-large {
        font-size: 2.05rem;
        font-weight: 700;
        color: #0b1f44;
      }

      .hero-subtext {
        font-size: 0.9rem;
        color: rgba(14, 23, 42, 0.6);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .hero-chart {
        background: rgba(255, 255, 255, 0.82);
        border-radius: 20px;
        border: 1px solid rgba(148, 163, 184, 0.25);
        padding: 18px 22px 20px;
        display: grid;
        gap: 0.9rem;
      }

      .hero-chart svg {
        width: 100%;
        height: 96px;
        display: block;
      }

      .history-summary {
        display: flex;
        justify-content: space-between;
        color: var(--text-muted);
        font-size: 0.86rem;
      }

      .history-summary span {
        background: rgba(37, 99, 235, 0.12);
        border-radius: 999px;
        padding: 0.35rem 0.75rem;
        color: var(--accent-secondary);
        font-weight: 600;
        letter-spacing: 0.03em;
      }

      .trend-up {
        color: var(--success);
        background: rgba(22, 163, 74, 0.12) !important;
      }

      .trend-down {
        color: var(--danger);
        background: rgba(220, 38, 38, 0.12) !important;
      }

      .layout-columns {
        display: grid;
        gap: 28px;
        grid-template-columns: minmax(0, 1.7fr) minmax(0, 1fr);
        align-items: start;
      }

      .column {
        display: grid;
        gap: 28px;
      }

      .cards {
        display: grid;
        gap: 1rem;
      }

      .grid-two {
        display: grid;
        gap: 1rem;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      }

      .grid-three {
        display: grid;
        gap: 1rem;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      }

      .grid-auto {
        display: grid;
        gap: 1rem;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      }

      .stat-box,
      .station-card,
      .list-card {
        background: var(--surface-soft);
        border-radius: 18px;
        border: 1px solid var(--border);
        padding: 1rem 1.2rem;
        display: grid;
        gap: 0.45rem;
      }

      .station-card {
        position: relative;
        overflow: hidden;
      }

      .station-card::after {
        content: "";
        position: absolute;
        inset: 0;
        pointer-events: none;
        background: linear-gradient(135deg, rgba(37, 99, 235, 0.08), transparent 70%);
      }

      .station-card .station-id {
        font-weight: 600;
        letter-spacing: 0.03em;
      }

      .station-card .metric {
        display: flex;
        justify-content: space-between;
        font-size: 0.95rem;
        color: var(--text-muted);
      }

      .health-indicator {
        width: 14px;
        height: 14px;
        border-radius: 50%;
        box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.12);
      }

      .health-optimal {
        background: #16a34a;
      }

      .health-stable {
        background: #2563eb;
      }

      .health-at-risk {
        background: #f97316;
      }

      .health-critical {
        background: #dc2626;
      }

      .metric-large {
        font-size: 1.9rem;
        font-weight: 700;
      }

      .alert {
        border-radius: 16px;
        padding: 0.92rem 1rem;
        border: 1px solid var(--border);
        background: var(--surface-soft);
        display: grid;
        gap: 0.35rem;
      }

      .alert.low {
        border-color: rgba(37, 99, 235, 0.2);
        background: rgba(37, 99, 235, 0.08);
      }

      .alert.medium {
        border-color: rgba(249, 115, 22, 0.25);
        background: rgba(249, 115, 22, 0.12);
      }

      .alert.high {
        border-color: rgba(220, 38, 38, 0.3);
        background: rgba(220, 38, 38, 0.1);
      }

      .alert-title {
        font-weight: 600;
        letter-spacing: 0.02em;
      }

      .data-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.85rem;
        background: var(--surface);
        border-radius: 16px;
        overflow: hidden;
      }

      .data-table th,
      .data-table td {
        padding: 0.65rem 0.8rem;
        text-align: left;
        border-bottom: 1px solid var(--border);
      }

      .data-table th {
        text-transform: uppercase;
        letter-spacing: 0.06em;
        font-size: 0.75rem;
        color: var(--text-muted);
      }

      .data-table tr:nth-child(even) {
        background: var(--surface-soft);
      }

      .badge-row {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
      }

      .badge {
        display: inline-flex;
        align-items: center;
        padding: 0.35rem 0.75rem;
        border-radius: 999px;
        border: 1px solid rgba(37, 99, 235, 0.25);
        background: rgba(37, 99, 235, 0.12);
        color: var(--accent);
        font-size: 0.78rem;
        letter-spacing: 0.05em;
        text-transform: uppercase;
      }

      .badge.critical {
        border-color: rgba(220, 38, 38, 0.3);
        background: rgba(220, 38, 38, 0.12);
        color: var(--danger);
      }

      .pill {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        padding: 0.3rem 0.7rem;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: var(--surface);
        font-size: 0.8rem;
        letter-spacing: 0.05em;
        text-transform: uppercase;
      }

      .pill.danger {
        border-color: rgba(220, 38, 38, 0.3);
        background: rgba(220, 38, 38, 0.12);
        color: var(--danger);
      }

      .pill.warn {
        border-color: rgba(249, 115, 22, 0.3);
        background: rgba(249, 115, 22, 0.12);
        color: var(--warning);
      }

      .pill.success {
        border-color: rgba(22, 163, 74, 0.3);
        background: rgba(22, 163, 74, 0.12);
        color: var(--success);
      }

      .list-card.critical {
        border-color: rgba(220, 38, 38, 0.28);
        background: rgba(220, 38, 38, 0.1);
      }

      .insight-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: grid;
        gap: 0.9rem;
      }

      .insight-list li {
        border: 1px solid var(--border);
        background: var(--surface-soft);
        border-radius: 16px;
        padding: 0.9rem 1.1rem;
        line-height: 1.5;
      }

      .leaderboard {
        list-style: none;
        padding: 0;
        margin: 0;
        display: grid;
        gap: 0.6rem;
      }

      .leaderboard li {
        display: flex;
        justify-content: space-between;
        border-bottom: 1px dashed var(--border);
        padding-bottom: 0.4rem;
        font-size: 0.9rem;
      }

      .list-group {
        display: grid;
        gap: 0.9rem;
      }

      .muted {
        color: var(--text-muted);
      }

      .warning-text {
        color: var(--warning);
        font-size: 0.82rem;
      }

      .app-footer {
        margin-top: auto;
        padding: 18px 40px 32px;
        text-align: right;
        font-size: 0.85rem;
        color: var(--text-muted);
      }

      @media (max-width: 1300px) {
        .layout-columns {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 1200px) {
        .sidebar {
          position: relative;
          height: auto;
          width: 230px;
        }

        .top-bar {
          flex-direction: column;
          align-items: flex-start;
        }

        .top-bar__meta {
          width: 100%;
        }
      }

      @media (max-width: 1024px) {
        .app-shell {
          flex-direction: column;
        }

        .sidebar {
          width: 100%;
          height: auto;
          position: relative;
          border-right: none;
          border-bottom: 1px solid var(--border);
          flex-direction: row;
          flex-wrap: wrap;
          gap: 16px;
        }

        .top-bar {
          padding: 26px 24px 16px;
        }

        .content-grid {
          padding: 0 24px 32px;
        }
      }

      @media (max-width: 640px) {
        .top-bar__meta {
          flex-direction: column;
          align-items: flex-start;
          gap: 12px;
        }

        section.panel {
          padding: 22px;
        }
      }
    </style>
  </head>
  <body>
    <div class="app-shell">
      <aside class="sidebar">
        <div class="sidebar__brand">
          <div class="sidebar__title">
            <span class="sidebar__logo">PS</span>
            <span>Project Sentinel</span>
          </div>
          <p class="sidebar__subtitle">Customer Experience Command Center</p>
        </div>
        <nav class="sidebar__nav">
          <a href="#overall-section">Store Pulse</a>
          <a href="#queue-section">Queue Stations</a>
          <a href="#staffing-section">Staffing</a>
          <a href="#alerts-section">Critical Alerts</a>
          <a href="#suspicious-section">Suspicious Checkouts</a>
          <a href="#detections-section">Detection Feed</a>
          <a href="#correlations-section">Correlated Checkouts</a>
          <a href="#correlation-radar-section">Correlation Radar</a>
          <a href="#inventory-section">Inventory</a>
          <a href="#insights-section">Insights</a>
          <a href="#stream-section">Stream Health</a>
          <a href="#evaluation-section">Evaluation</a>
        </nav>
        <div class="sidebar__support">
          Seamless operations overview across queue, RFID, POS, and vision telemetry.
        </div>
      </aside>

      <div class="app-main">
        <header class="top-bar">
          <div class="top-bar__titles">
            <h1>Live operations overview</h1>
            <p class="muted">AI-assisted loss prevention, queue intelligence, and inventory protection insights refreshed continuously.</p>
          </div>
          <div class="top-bar__meta">
            <div class="status-chip">
              <span class="status-dot"></span>
              <span id="system-status">Live</span>
            </div>
            <div class="sync-indicator">
              <span>Last sync</span>
              <strong id="last-updated">--</strong>
            </div>
          </div>
        </header>

        <main class="content-grid">
          <section id="overall-section" class="panel panel--hero panel--wide">
            <div class="panel__header">
              <div>
                <h2 class="panel__title">Store Pulse</h2>
                <p class="panel__hint">Unified signal across dwell, staffing, and in-store telemetry.</p>
              </div>
              <div class="panel__meta">
                <span class="chip chip--outline" id="system-status-text">--</span>
              </div>
            </div>
            <div class="hero-grid">
              <article class="hero-card">
                <h3>Overall Health</h3>
                <div id="overall-health" class="metric-large">--</div>
                <div class="hero-subtext">Current state</div>
              </article>
              <article class="hero-card">
                <h3>Total Customers</h3>
                <div id="total-customers" class="metric-large">--</div>
                <div class="hero-subtext">Active stations: <span id="active-stations">--</span></div>
              </article>
              <article class="hero-card">
                <h3>Staffing Focus</h3>
                <div id="staffing-recommendation" style="font-size: 1.2rem; font-weight: 600">--</div>
                <div class="hero-subtext">Target per station: <span id="target-per-station">--</span></div>
              </article>
            </div>
            <div class="hero-chart">
              <svg id="overall-history-chart" viewBox="0 0 320 90" preserveAspectRatio="none"></svg>
              <div class="history-summary">
                <span id="overall-trend">Trend --</span>
                <span id="overall-load">Load --</span>
              </div>
            </div>
          </section>

          <div class="layout-columns">
            <div class="column column--primary">
              <section id="queue-section" class="panel">
                <div class="panel__header">
                  <div>
                    <h2 class="panel__title">Queue Stations</h2>
                    <p class="panel__hint">Live dwell, health scores, and throughput by kiosk.</p>
                  </div>
                </div>
                <div class="cards" id="stations"></div>
              </section>

              <section id="staffing-section" class="panel">
                <div class="panel__header">
                  <div>
                    <h2 class="panel__title">Staffing Insights</h2>
                    <p class="panel__hint">Match floor associates to forecasted demand.</p>
                  </div>
                </div>
                <div id="staffing-kpis" class="grid-two"></div>
              </section>

              <section id="alerts-section" class="panel">
                <div class="panel__header">
                  <div>
                    <h2 class="panel__title">Critical Alerts</h2>
                    <p class="panel__hint">Immediate incidents surfaced from computer vision and queue analytics.</p>
                  </div>
                </div>
                <div id="alerts"></div>
              </section>

              <section id="suspicious-section" class="panel">
                <div class="panel__header">
                  <div>
                    <h2 class="panel__title">Suspicious Checkouts</h2>
                    <p class="panel__hint">Risky behaviors flagged for manual intervention.</p>
                  </div>
                </div>
                <div id="suspicious"></div>
              </section>

              <section id="detections-section" class="panel">
                <div class="panel__header">
                  <div>
                    <h2 class="panel__title">Detection Feed</h2>
                    <p class="panel__hint">Recent detector outputs with contextual evidence.</p>
                  </div>
                </div>
                <div id="detections" class="list-group"></div>
              </section>
            </div>

            <div class="column column--secondary">
              <section id="correlations-section" class="panel">
                <div class="panel__header">
                  <div>
                    <h2 class="panel__title">Correlated Checkouts</h2>
                    <p class="panel__hint">Cross-signal alignment across POS, RFID, and vision.</p>
                  </div>
                </div>
                <div class="list-group" id="correlations"></div>
              </section>

              <section id="correlation-radar-section" class="panel">
                <div class="panel__header">
                  <div>
                    <h2 class="panel__title">Correlation Radar</h2>
                    <p class="panel__hint">Top SKUs and stations under investigation.</p>
                  </div>
                </div>
                <div class="grid-two">
                  <div class="stat-box">
                    <div class="muted">Top Correlated SKUs</div>
                    <ul id="correlated-skus" class="leaderboard"></ul>
                  </div>
                  <div class="stat-box">
                    <div class="muted">Stations Under Watch</div>
                    <ul id="stations-under-watch" class="leaderboard"></ul>
                  </div>
                </div>
                <div>
                  <h3>Recent Correlations</h3>
                  <div id="recent-correlations" class="list-group"></div>
                </div>
              </section>

              <section id="inventory-section" class="panel">
                <div class="panel__header">
                  <div>
                    <h2 class="panel__title">Inventory Watch</h2>
                    <p class="panel__hint">Shrinkage exposure, high-value watch list, and SKU deltas.</p>
                  </div>
                </div>
                <div class="grid-two">
                  <div class="stat-box">
                    <div class="muted">Shrinkage Value</div>
                    <div id="inventory-shrinkage-value" class="metric-large">--</div>
                  </div>
                  <div class="stat-box">
                    <div class="muted">Shrinkage Units</div>
                    <div id="inventory-shrinkage-units" class="metric-large">--</div>
                  </div>
                  <div class="stat-box" style="grid-column: 1 / -1;">
                    <div class="muted">Actual Inventory Value</div>
                    <div id="inventory-actual-value" class="metric-large">--</div>
                    <div class="muted" id="inventory-expected-value">Expected --</div>
                  </div>
                </div>
                <div class="list-group">
                  <div>
                    <h3>Shrinkage Alerts</h3>
                    <div id="inventory-alerts" class="list-group"></div>
                  </div>
                  <div>
                    <h3>High-Value Watchlist</h3>
                    <div id="inventory-high-value" class="list-group"></div>
                  </div>
                  <div>
                    <h3>Top Shrinkage SKUs</h3>
                    <div id="inventory-top-shrink"></div>
                  </div>
                </div>
              </section>

              <section id="insights-section" class="panel">
                <div class="panel__header">
                  <div>
                    <h2 class="panel__title">Operational Insights</h2>
                    <p class="panel__hint">Latest analyst notes, AI findings, and narrative summaries.</p>
                  </div>
                </div>
                <ul id="insights" class="insight-list"></ul>
              </section>

              <section id="stream-section" class="panel">
                <div class="panel__header">
                  <div>
                    <h2 class="panel__title">Data Feed Health</h2>
                    <p class="panel__hint">Dataset throughput, freshness, and stream reader uptime.</p>
                  </div>
                </div>
                <div class="grid-two">
                  <div class="stat-box">
                    <div class="muted">Events last minute</div>
                    <div id="stream-events-minute" class="metric-large">--</div>
                  </div>
                  <div class="stat-box">
                    <div class="muted">Events per minute</div>
                    <div id="stream-events-rate" class="metric-large">--</div>
                    <div class="muted" id="stream-last-event">Last event --</div>
                  </div>
                </div>
                <div>
                  <h3>Active Datasets</h3>
                  <div id="stream-datasets" class="badge-row"></div>
                </div>
                <div>
                  <h3>Dataset Throughput</h3>
                  <div id="stream-dataset-cards" class="list-group"></div>
                </div>
                <div>
                  <h3>Stream Reader</h3>
                  <div id="stream-reader-status" class="list-group"></div>
                  <ul id="stream-warnings" class="insight-list" style="margin-top: 0.8rem"></ul>
                </div>
              </section>

              <section id="evaluation-section" class="panel">
                <div class="panel__header">
                  <div>
                    <h2 class="panel__title">Pipeline Evaluation</h2>
                    <p class="panel__hint">Precision/recall metrics and exceptions from the latest regression.
                    </p>
                  </div>
                </div>
                <div id="evaluation-cards" class="grid-auto"></div>
                <div>
                  <h3>Exceptions</h3>
                  <div id="evaluation-exceptions" class="list-group"></div>
                </div>
              </section>
            </div>
          </div>
        </main>

        <footer class="app-footer">
          Sentinel CX Analytics · Powered by Python standard library &amp; vanilla JS
        </footer>
      </div>
    </div>

    <script>
      const apiHost = window.location.hostname || "localhost";
      const API_BASE = `http://${apiHost}:5000`;
      console.info(`[sentinel] dashboard targeting API at ${API_BASE}`);
      const currencyFormatter = new Intl.NumberFormat("en-US", {
        style: "currency",
        currency: "USD",
        maximumFractionDigits: 0,
      });
      const numberFormatter = new Intl.NumberFormat("en-US", {
        maximumFractionDigits: 1,
      });

      function formatSeconds(value) {
        if (value === null || value === undefined || Number.isNaN(value)) return "--";
        const seconds = Number(value);
        if (seconds < 60) return `${numberFormatter.format(seconds)}s`;
        const minutes = seconds / 60;
        if (minutes < 120) return `${numberFormatter.format(minutes)}m`;
        const hours = minutes / 60;
        if (hours < 48) return `${numberFormatter.format(hours)}h`;
        const days = hours / 24;
        return `${numberFormatter.format(days)}d`;
      }

      function formatTimestamp(value) {
        if (!value) return "--";
        try {
          return new Date(value).toLocaleTimeString();
        } catch (err) {
          return value;
        }
      }

      function toTitleCase(value) {
        if (!value) return "";
        return value
          .toString()
          .replace(/_/g, " ")
          .replace(/\b\w/g, (char) => char.toUpperCase());
      }

      function classifyHealth(score) {
        if (score >= 85) return "health-optimal";
        if (score >= 70) return "health-stable";
        if (score >= 50) return "health-at-risk";
        return "health-critical";
      }

      function renderStations(stations) {
        const container = document.getElementById("stations");
        container.innerHTML = "";
        if (!stations || stations.length === 0) {
          container.innerHTML = '<p class="muted">No active stations yet.</p>';
          return;
        }
        stations.forEach((station) => {
          const indicator = classifyHealth(station.health_score || 0);
          const card = document.createElement("div");
          card.className = "station-card";
          card.innerHTML = `
            <div style="display:flex; justify-content: space-between; align-items:center; position:relative; z-index:1;">
              <div class="station-id">${station.station_id}</div>
              <span class="health-indicator ${indicator}"></span>
            </div>
            <div class="metric" style="position:relative; z-index:1;"><span>Health score</span><strong>${station.health_score ?? "--"}</strong></div>
            <div class="metric" style="position:relative; z-index:1;"><span>Queue length</span><span>${station.customer_count ?? "--"} customers</span></div>
            <div class="metric" style="position:relative; z-index:1;"><span>Dwell time</span><span>${station.average_dwell_time ?? "--"}s</span></div>
            <div class="metric" style="position:relative; z-index:1;"><span>Service rate</span><span>${station.service_rate ?? "--"}/min</span></div>
            <div class="metric" style="position:relative; z-index:1;"><span>Status</span><span style="text-transform: capitalize;">${station.status ?? "--"}</span></div>
          `;
          container.appendChild(card);
        });
      }

      function renderAlerts(incidents) {
        const container = document.getElementById("alerts");
        container.innerHTML = "";
        if (!incidents || incidents.length === 0) {
          container.innerHTML = '<p class="muted">No active incidents.</p>';
          return;
        }
        incidents.forEach((incident) => {
          const alert = document.createElement("div");
          alert.className = `alert ${incident.priority || ""}`;
          alert.innerHTML = `
            <div class="alert-title">${incident.message || incident.type}</div>
            <div class="muted">${incident.station_id || "--"} • ${new Date(incident.timestamp).toLocaleTimeString()}</div>
          `;
          container.appendChild(alert);
        });
      }

      function renderStaffing(staffing) {
        const container = document.getElementById("staffing-kpis");
        container.innerHTML = "";
        if (!staffing) {
          container.innerHTML = '<p class="muted">Staffing data will appear once queues are active.</p>';
          return;
        }

        const stats = [
          {
            label: "Active stations",
            value: staffing.active_stations ?? "--",
            note: "Currently serving customers",
          },
          {
            label: "Required stations",
            value: staffing.required_stations ?? "--",
            note: "Needed to meet demand",
          },
          {
            label: "Efficiency ratio",
            value: staffing.efficiency_ratio?.toFixed(2) ?? "--",
            note: "Customers vs. target",
          },
        ];

        stats.forEach((item) => {
          const box = document.createElement("div");
          box.className = "stat-box";
          box.innerHTML = `
            <div class="muted">${item.label}</div>
            <div style="font-size: 1.5rem; font-weight: 600">${item.value}</div>
            <div class="muted">${item.note}</div>
          `;
          container.appendChild(box);
        });
      }

      function renderCorrelations(correlations) {
        const container = document.getElementById("correlations");
        container.innerHTML = "";
        const recents = (correlations && correlations.recent_correlations) || correlations?.recent || [];
        const summaryList = recents.slice(0, 6);
        if (summaryList.length === 0) {
          container.innerHTML = '<p class="muted">No recent correlated checkouts.</p>';
        } else {
          summaryList.forEach((event) => {
            const card = document.createElement("div");
            card.className = "alert low";
            card.innerHTML = `
              <div class="alert-title">${event.sku || "SKU"} • ${event.station_id || "--"}</div>
              <div class="muted">Confidence ${(event.confidence ?? 0).toFixed(2)} — RFID ${event.rfid_matches ?? 0} / Vision ${event.vision_matches ?? 0}</div>
              <div class="muted">${new Date(event.timestamp || Date.now()).toLocaleTimeString()}</div>
            `;
            container.appendChild(card);
          });
        }

        renderLeaderboard(
          document.getElementById("correlated-skus"),
          correlations?.top_correlated_skus || [],
          (entry) => ({
            label: Array.isArray(entry) ? entry[0] : entry.sku || "SKU",
            value: Array.isArray(entry) ? entry[1] : entry.count || entry.score || "--",
          })
        );

        renderLeaderboard(
          document.getElementById("stations-under-watch"),
          correlations?.stations_under_watch || [],
          (entry) => ({
            label: Array.isArray(entry) ? entry[0] : entry.station_id || "station",
            value: Array.isArray(entry) ? entry[1] : entry.count || "--",
          })
        );

        const recentContainer = document.getElementById("recent-correlations");
        recentContainer.innerHTML = "";
        const recentsList = correlations?.recent_correlations || correlations?.recent || [];
        if (!recentsList.length) {
          recentContainer.innerHTML = '<p class="muted">No recent correlated checkouts.</p>';
          return;
        }
        recentsList
          .slice(-5)
          .reverse()
          .forEach((item) => {
            const card = document.createElement("div");
            card.className = "list-card";
            card.innerHTML = `
              <strong>${item.sku || "SKU"} @ ${item.station_id || "--"}</strong>
              <span class="muted">Confidence ${(item.confidence ?? 0).toFixed(2)} · RFID ${item.rfid_matches ?? 0} · Vision ${item.vision_matches ?? 0}</span>
              <span class="muted">${new Date(item.timestamp || Date.now()).toLocaleTimeString()}</span>
            `;
            recentContainer.appendChild(card);
          });
      }

      function renderDetections(events) {
        const container = document.getElementById("detections");
        container.innerHTML = "";
        if (!events || events.length === 0) {
          container.innerHTML = '<p class="muted">No detections received.</p>';
          return;
        }

        const recent = events.slice(-6).reverse();
        recent.forEach((event) => {
          const card = document.createElement("div");
          card.className = "list-card";
          const details = event.details || {};
          const type = toTitleCase(details.type || details.event_type || "Detection");
          const confidenceRaw = details.confidence;
          const confidenceValue = typeof confidenceRaw === "number" ? confidenceRaw : Number.parseFloat(confidenceRaw);
          const hasConfidence = Number.isFinite(confidenceValue);
          const evidence = details.evidence || details.attributes;
          let evidenceSummary = "";
          if (evidence && typeof evidence === "object") {
            evidenceSummary = Object.entries(evidence)
              .slice(0, 3)
              .map(([key, value]) => `${key}: ${value}`)
              .join(", ");
          }
          const notes = details.notes || details.message || "";
          card.innerHTML = `
            <div style="display:flex; justify-content: space-between; align-items:center; gap: 0.6rem;">
              <strong>${type}</strong>
              ${hasConfidence ? `<span class="badge">${confidenceValue.toFixed(2)}</span>` : ""}
            </div>
            <span class="muted">${event.station_id || "--"} • ${new Date(event.timestamp || Date.now()).toLocaleTimeString()}</span>
            ${notes ? `<span>${notes}</span>` : ""}
            ${evidenceSummary ? `<span class="muted">${evidenceSummary}</span>` : ""}
          `;
          container.appendChild(card);
        });
      }

      function renderSuspicious(events) {
        const container = document.getElementById("suspicious");
        container.innerHTML = "";
        if (!events || events.length === 0) {
          container.innerHTML = '<p class="muted">All checkouts look healthy.</p>';
          return;
        }
        events.forEach((event) => {
          const alert = document.createElement("div");
          alert.className = "alert high";
          alert.innerHTML = `
            <div class="alert-title">SKU ${event.sku || "??"} @ ${event.station_id}</div>
            <div class="muted">${(event.reasons || []).join(", ")}</div>
            <div class="muted">Confidence: ${(event.confidence ?? 0).toFixed(2)}</div>
          `;
          container.appendChild(alert);
        });
      }

      function renderInventory(report) {
        const shrinkValue = report?.summary?.total_shrinkage_value;
        const shrinkUnits = report?.summary?.total_shrinkage_units || report?.summary?.shrinkage_units;
        const actualValue = report?.summary?.overall_actual_value;
        const expectedValue = report?.summary?.overall_expected_value;

        document.getElementById("inventory-shrinkage-value").textContent =
          typeof shrinkValue === "number" ? currencyFormatter.format(shrinkValue) : "--";
        document.getElementById("inventory-shrinkage-units").textContent =
          typeof shrinkUnits === "number" ? numberFormatter.format(shrinkUnits) : "--";
        document.getElementById("inventory-actual-value").textContent =
          typeof actualValue === "number" ? currencyFormatter.format(actualValue) : "--";
        document.getElementById("inventory-expected-value").textContent =
          typeof expectedValue === "number"
            ? `Expected ${currencyFormatter.format(expectedValue)}`
            : "Expected --";

        const alertsContainer = document.getElementById("inventory-alerts");
        const watchContainer = document.getElementById("inventory-high-value");
        const shrinkContainer = document.getElementById("inventory-top-shrink");
        alertsContainer.innerHTML = "";
        watchContainer.innerHTML = "";
        shrinkContainer.innerHTML = "";

        if (!report) {
          alertsContainer.innerHTML = '<p class="muted">Awaiting inventory snapshot.</p>';
          watchContainer.innerHTML = '<p class="muted">Awaiting inventory snapshot.</p>';
          shrinkContainer.innerHTML = '<p class="muted">Awaiting inventory snapshot.</p>';
          return;
        }

        const shrinkageAlerts = report.alerts?.shrinkage || [];
        if (shrinkageAlerts.length === 0) {
          alertsContainer.innerHTML = '<p class="muted">No shrinkage alerts at the moment.</p>';
        } else {
          shrinkageAlerts.slice(0, 5).forEach((alert) => {
            const card = document.createElement("div");
            card.className = "list-card";
            const priorityBadge = `<span class="badge ${alert.priority === "high" ? "critical" : ""}">${
              toTitleCase(alert.priority || "medium")
            }</span>`;
            card.innerHTML = `
              <div style="display:flex; justify-content: space-between; align-items:center; gap: 0.5rem;">
                <strong>${alert.product_name || alert.sku}</strong>
                ${priorityBadge}
              </div>
              <span class="muted">SKU ${alert.sku}</span>
              <span class="muted">Shrinkage ${alert.shrinkage_units || alert.delta_units} units · ${currencyFormatter.format(
                alert.shrinkage_value || alert.delta_value || 0
              )}</span>
            `;
            alertsContainer.appendChild(card);
          });
        }

        const highValue = report.alerts?.high_value_watch || [];
        if (highValue.length === 0) {
          watchContainer.innerHTML = '<p class="muted">All high-value items are sufficiently stocked.</p>';
        } else {
          highValue.slice(0, 5).forEach((item) => {
            const card = document.createElement("div");
            card.className = "list-card";
            card.innerHTML = `
              <strong>${item.product_name || item.sku}</strong>
              <span class="muted">SKU ${item.sku} · On hand ${item.units_on_hand}</span>
              <span class="muted">Unit price ${currencyFormatter.format(item.unit_price || 0)}</span>
              <span class="muted">${item.message || "Monitor closely"}</span>
            `;
            watchContainer.appendChild(card);
          });
        }

        const perSku = report.skus || {};
        const shrinkRows = Object.entries(perSku)
          .map(([sku, stats]) => ({ sku, ...stats }))
          .filter((row) => Number.isFinite(row.delta_units) && row.delta_units > 0)
          .sort((a, b) => (b.delta_value ?? 0) - (a.delta_value ?? 0))
          .slice(0, 8);

        if (shrinkRows.length === 0) {
          shrinkContainer.innerHTML = '<p class="muted">No shrinkage detected in the monitored SKUs.</p>';
        } else {
          const table = document.createElement("table");
          table.className = "data-table";
          table.innerHTML = `
            <thead>
              <tr>
                <th>SKU</th>
                <th>Expected</th>
                <th>Actual</th>
                <th>Delta</th>
                <th>Value</th>
              </tr>
            </thead>
            <tbody>
              ${shrinkRows
                .map((row) => {
                  const value = typeof row.delta_value === "number" ? currencyFormatter.format(row.delta_value) : "--";
                  return `
                    <tr>
                      <td>${row.product_name || row.sku}</td>
                      <td>${row.expected_after_sales ?? "--"}</td>
                      <td>${row.actual ?? "--"}</td>
                      <td>${row.delta_units ?? "--"}</td>
                      <td>${value}</td>
                    </tr>
                  `;
                })
                .join("")}
            </tbody>
          `;
          shrinkContainer.appendChild(table);
        }
      }

      function renderInsights(insights) {
        const container = document.getElementById("insights");
        container.innerHTML = "";
        if (!insights || insights.length === 0) {
          const empty = document.createElement("li");
          empty.className = "muted";
          empty.textContent = "No additional insights yet.";
          container.appendChild(empty);
          return;
        }

        insights
          .slice(-5)
          .reverse()
          .forEach((insight) => {
            const li = document.createElement("li");
            if (typeof insight === "string") {
              li.textContent = insight;
            } else {
              const primary =
                insight.insight || insight.message || insight.summary || JSON.stringify(insight, null, 0);
              const analyst = insight.analyst || insight.owner || "";
              const focus = insight.focus || insight.category || "";
              const timestamp = insight.timestamp ? new Date(insight.timestamp).toLocaleTimeString() : "";
              li.innerHTML = `
                <strong>${primary}</strong>
                <div class="muted">${[analyst, focus].filter(Boolean).join(" · ")}</div>
                ${timestamp ? `<div class="muted">${timestamp}</div>` : ""}
              `;
            }
            container.appendChild(li);
          });
      }

      function renderLeaderboard(listElement, entries, formatter) {
        if (!listElement) return;
        listElement.innerHTML = "";
        if (!entries || entries.length === 0) {
          const item = document.createElement("li");
          item.className = "muted";
          item.textContent = "No data";
          listElement.appendChild(item);
          return;
        }
        entries.forEach((entry) => {
          const li = document.createElement("li");
          const { label, value } = formatter(entry);
          li.innerHTML = `<span>${label}</span><span>${value}</span>`;
          listElement.appendChild(li);
        });
      }

      function renderOverallHistory(history) {
        const svg = document.getElementById("overall-history-chart");
        const trendEl = document.getElementById("overall-trend");
        const loadEl = document.getElementById("overall-load");
        if (!svg || !trendEl || !loadEl) return;

        if (!history || !Array.isArray(history.scores) || history.scores.length < 2) {
          svg.innerHTML = '<text x="12" y="50" fill="#94a3b8">Waiting for history…</text>';
          trendEl.textContent = "Trend --";
          trendEl.classList.remove("trend-up", "trend-down");
          loadEl.textContent = "Load --";
          return;
        }

        const scores = history.scores.slice(-40);
        const loads = Array.isArray(history.loads) ? history.loads.slice(-40) : [];
        const width = 320;
        const height = 90;
        const leftPad = 6;
        const rightPad = 6;
        const usableWidth = width - leftPad - rightPad;
        const minScore = Math.min(...scores, 0);
        const maxScore = Math.max(...scores, 100);
        const range = Math.max(maxScore - minScore, 1);
        const pointCount = scores.length;
        const points = scores.map((score, idx) => {
          const ratio = pointCount === 1 ? 0 : idx / (pointCount - 1);
          const x = leftPad + ratio * usableWidth;
          const y = height - ((score - minScore) / range) * (height - 12) - 6;
          return `${x.toFixed(1)},${y.toFixed(1)}`;
        });

        const baselineScore = Math.min(Math.max(100, minScore), maxScore);
        const baseline = height - ((baselineScore - minScore) / range) * (height - 12) - 6;

        svg.innerHTML = `
          <polyline points="${points.join(" ")}" fill="none" stroke="#2563eb" stroke-width="2.5" stroke-linecap="round" />
          <line x1="${leftPad}" y1="${baseline.toFixed(1)}" x2="${width - rightPad}" y2="${baseline.toFixed(1)}" stroke="rgba(148,163,184,0.35)" stroke-dasharray="4 5" />
        `;

        const delta = scores[scores.length - 1] - scores[0];
        trendEl.textContent = `Trend ${delta >= 0 ? "+" : ""}${delta.toFixed(1)} pts`;
        trendEl.classList.remove("trend-up", "trend-down");
        trendEl.classList.add(delta >= 0 ? "trend-up" : "trend-down");

        const latestLoad = loads.length ? loads[loads.length - 1] : null;
        const avgWindow = loads.slice(-6);
        const avgLoad = avgWindow.length
          ? avgWindow.reduce((acc, value) => acc + (value ?? 0), 0) / avgWindow.length
          : null;
        loadEl.textContent =
          latestLoad !== null && latestLoad !== undefined
            ? `Load ${latestLoad} customers • avg ${avgLoad !== null ? avgLoad.toFixed(1) : "--"}`
            : "Load --";
      }

      function renderStreamHealth(health) {
        const eventsLastMinute = Number.isFinite(health?.events_last_minute) ? health.events_last_minute : null;
        const eventsPerMinute = Number.isFinite(health?.events_per_minute) ? health.events_per_minute : null;
        const lastEventAgo = Number.isFinite(health?.last_event_seconds_ago) ? health.last_event_seconds_ago : null;
        const datasets = Array.isArray(health?.datasets)
          ? health.datasets
          : Array.isArray(health?.active_datasets)
          ? health.active_datasets.map((name) => ({ dataset: name }))
          : [];

        document.getElementById("stream-events-minute").textContent =
          eventsLastMinute !== null ? eventsLastMinute.toString() : "--";
        document.getElementById("stream-events-rate").textContent =
          eventsPerMinute !== null ? numberFormatter.format(eventsPerMinute) : "--";
        document.getElementById("stream-last-event").textContent =
          lastEventAgo !== null ? `Last event ${formatSeconds(lastEventAgo)} ago` : "Last event --";

        const datasetBadges = document.getElementById("stream-datasets");
        datasetBadges.innerHTML = "";
        if (!datasets.length) {
          datasetBadges.innerHTML = '<span class="muted">Awaiting stream activity.</span>';
        } else {
          datasets.forEach((dataset) => {
            const badge = document.createElement("span");
            const stale = Number.isFinite(dataset.last_seen_seconds_ago) && dataset.last_seen_seconds_ago > 120;
            badge.className = `badge${stale ? " critical" : ""}`;
            badge.textContent = (dataset.dataset || dataset).toString().toUpperCase();
            datasetBadges.appendChild(badge);
          });
        }

        const datasetCards = document.getElementById("stream-dataset-cards");
        datasetCards.innerHTML = "";
        if (!datasets.length) {
          datasetCards.innerHTML = '<p class="muted">No dataset telemetry yet.</p>';
        } else {
          datasets
            .slice()
            .sort((a, b) => (b.events_last_minute ?? 0) - (a.events_last_minute ?? 0))
            .forEach((dataset) => {
              const stale = Number.isFinite(dataset.last_seen_seconds_ago) && dataset.last_seen_seconds_ago > 180;
              const card = document.createElement("div");
              card.className = `list-card${stale ? " critical" : ""}`;
              const statusClass = stale ? "danger" : "success";
              card.innerHTML = `
                <div style="display:flex; justify-content: space-between; align-items:center; gap: 0.4rem;">
                  <strong>${(dataset.dataset || "dataset").toString().toUpperCase()}</strong>
                  <span class="pill ${statusClass}">${stale ? "Stale" : "Healthy"}</span>
                </div>
                <span class="muted">Last seen ${formatSeconds(dataset.last_seen_seconds_ago)} ago (${formatTimestamp(dataset.last_seen)})</span>
                <span class="muted">Throughput: ${dataset.events_last_minute ?? 0} / min · ${dataset.events_last_15_minutes ?? 0} in 15m</span>
              `;
              datasetCards.appendChild(card);
            });
        }

        const readerContainer = document.getElementById("stream-reader-status");
        readerContainer.innerHTML = "";
        const reader = health?.reader_status || {};
        const readerCard = document.createElement("div");
        const connected = Boolean(reader.connected);
        readerCard.className = "list-card";
        readerCard.innerHTML = `
          <div style="display:flex; justify-content: space-between; align-items:center; gap: 0.4rem;">
            <strong>${connected ? "Stream reader connected" : "Stream reader offline"}</strong>
            <span class="pill ${connected ? "success" : "danger"}">${connected ? "Connected" : "Offline"}</span>
          </div>
          <span class="muted">Processed events: ${reader.processed_events ?? 0}</span>
          <span class="muted">Last heartbeat ${formatSeconds(reader.seconds_since_heartbeat ?? null)} ago (${formatTimestamp(
            reader.last_heartbeat
          )})</span>
          ${reader.latency_ms !== undefined && reader.latency_ms !== null ? `<span class="muted">Latency ${numberFormatter.format(reader.latency_ms)} ms</span>` : ""}
          ${reader.notes ? `<span>${reader.notes}</span>` : ""}
        `;
        readerContainer.appendChild(readerCard);

        const warnings = document.getElementById("stream-warnings");
        warnings.innerHTML = "";
        const staleDatasets = datasets.filter((dataset) => Number.isFinite(dataset.last_seen_seconds_ago) && dataset.last_seen_seconds_ago > 180);
        if (staleDatasets.length) {
          staleDatasets.forEach((dataset) => {
            const li = document.createElement("li");
            li.className = "warning-text";
            li.textContent = `${(dataset.dataset || dataset).toString().toUpperCase()} idle for ${formatSeconds(
              dataset.last_seen_seconds_ago
            )}. Investigate ingestion.`;
            warnings.appendChild(li);
          });
        } else if (!datasets.length) {
          const li = document.createElement("li");
          li.className = "muted";
          li.textContent = "Waiting for stream activity.";
          warnings.appendChild(li);
        } else {
          const li = document.createElement("li");
          li.className = "muted";
          li.textContent = "Stream telemetry within healthy thresholds.";
          warnings.appendChild(li);
        }
      }

      function renderEvaluation(metrics) {
        const cards = document.getElementById("evaluation-cards");
        const exceptions = document.getElementById("evaluation-exceptions");
        if (!cards || !exceptions) return;

        cards.innerHTML = "";
        exceptions.innerHTML = "";

        if (!metrics) {
          cards.innerHTML = '<div class="stat-box"><div class="muted">Evaluation</div><div class="metric-large">--</div><div class="muted">Run evaluation to populate metrics.</div></div>';
          const li = document.createElement("div");
          li.className = "muted";
          li.textContent = "No evaluation results ingested yet.";
          exceptions.appendChild(li);
          return;
        }

        const stats = [
          {
            label: "Precision",
            value: Number.isFinite(metrics.precision) ? (metrics.precision * 100).toFixed(1) + "%" : "--",
            note: "Share of predicted events that were correct",
          },
          {
            label: "Recall",
            value: Number.isFinite(metrics.recall) ? (metrics.recall * 100).toFixed(1) + "%" : "--",
            note: "Coverage of reference events",
          },
          {
            label: "F1 Score",
            value: Number.isFinite(metrics.f1) ? (metrics.f1 * 100).toFixed(1) + "%" : "--",
            note: `Support ${metrics.support ?? "--"} events`,
          },
        ];

        stats.forEach((stat) => {
          const card = document.createElement("div");
          card.className = "stat-box";
          card.innerHTML = `
            <div class="muted">${stat.label}</div>
            <div class="metric-large">${stat.value}</div>
            <div class="muted">${stat.note}</div>
          `;
          cards.appendChild(card);
        });

        const timestamp = metrics.timestamp ? formatTimestamp(metrics.timestamp) : "--";
        const summaryCard = document.createElement("div");
        summaryCard.className = "stat-box";
        summaryCard.innerHTML = `
          <div class="muted">Last evaluated</div>
          <div style="font-size:1.1rem; font-weight:600">${timestamp}</div>
          <div class="muted">Fields: ${(metrics.fields || []).join(", ") || "default"}</div>
        `;
        cards.appendChild(summaryCard);

        const fp = Array.isArray(metrics.false_positives) ? metrics.false_positives : [];
        const fn = Array.isArray(metrics.false_negatives) ? metrics.false_negatives : [];

        if (fp.length === 0 && fn.length === 0) {
          const li = document.createElement("div");
          li.className = "muted";
          li.textContent = "No anomalies detected in evaluation run.";
          exceptions.appendChild(li);
          return;
        }

        const buildList = (title, items, tone) => {
          if (!items.length) {
            return;
          }
          const card = document.createElement("div");
          card.className = "list-card";
          card.innerHTML = `<strong>${title}</strong>`;
          items.slice(0, 5).forEach((item) => {
            const span = document.createElement("span");
            span.className = tone === "warn" ? "warning-text" : "muted";
            span.textContent = Array.isArray(item) ? item.join(" • ") : JSON.stringify(item);
            card.appendChild(span);
          });
          if (items.length > 5) {
            const more = document.createElement("span");
            more.className = "muted";
            more.textContent = `+${items.length - 5} additional`;
            card.appendChild(more);
          }
          exceptions.appendChild(card);
        };

        buildList("False positives", fp, "warn");
        buildList("False negatives", fn, "warn");
      }

      async function refreshDashboard() {
        try {
          const response = await fetch(`${API_BASE}/api/dashboard`);
          if (!response.ok) throw new Error("Dashboard unavailable");
          const data = await response.json();
          const queue = data.queue || {};
          document.getElementById("last-updated").textContent = new Date(data.timestamp || Date.now()).toLocaleTimeString();
          document.getElementById("overall-health").textContent = `${queue.overall_health_score ?? "--"}`;
          document.getElementById("system-status-text").textContent = data.system_status ?? "--";
          document.getElementById("total-customers").textContent = queue.staffing?.total_customers ?? "--";
          document.getElementById("active-stations").textContent = queue.staffing?.active_stations ?? "--";
          document.getElementById("staffing-recommendation").textContent = queue.staffing?.recommendation || "--";
          document.getElementById("target-per-station").textContent = queue.staffing?.target_per_station ?? "--";

          renderStations(queue.stations || []);
          renderStaffing(queue.staffing || null);
          renderCorrelations(data.correlations || {});
          renderInventory(data.inventory || null);
          renderInsights(data.enriched_insights || []);
          renderOverallHistory(queue.overall_history || null);
          renderStreamHealth({ ...(data.stream_health || {}), reader_status: data.stream_reader || (data.stream_health?.reader_status ?? {}) });
          renderEvaluation(data.evaluation_metrics || null);
        } catch (error) {
          console.error(error);
          document.getElementById("system-status").textContent = "Offline";
        }
      }

      async function refreshAlerts() {
        try {
          const response = await fetch(`${API_BASE}/api/alerts`);
          if (!response.ok) throw new Error("Alert feed unavailable");
          const data = await response.json();
          renderAlerts(data.queue_incidents || []);
          renderDetections(data.detection_events || []);
          renderSuspicious(data.suspicious_checkouts || []);
        } catch (error) {
          console.error(error);
        }
      }

      refreshDashboard();
      refreshAlerts();
      setInterval(refreshDashboard, 3000);
      setInterval(refreshAlerts, 3000);
    </script>
  </body>
</html>
